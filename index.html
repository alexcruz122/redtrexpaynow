<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Webxpay Test</title>
</head>
<body>
<h2>Webxpay Payment</h2>
<input type="text" id="amount" value="100.00">
<input type="text" id="currency" value="LKR">
<button id="payButton">Pay Now</button>

<script>
const backendUrl = "https://webxpayipg.onrender.com/create-payment";

document.getElementById("payButton").addEventListener("click", async () => {
  const orderId = "TEST-" + Date.now();
  const amount = document.getElementById("amount").value;
  const currency = document.getElementById("currency").value;

  try {
    const response = await fetch(backendUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ order_id: orderId, amount, currency })
    });

    const html = await response.text();
    if (!response.ok) throw new Error(html);

    const tempDiv = document.createElement("div");
    tempDiv.innerHTML = html;
    const form = tempDiv.querySelector("#redirectForm");
    if (form) {
      document.body.innerHTML = "<h2>Redirecting to Webxpay...</h2>";
      document.body.appendChild(form);
      form.submit();
    } else {
      alert("Payment form not found.");
    }
  } catch (err) {
    console.error("Payment error:", err);
    alert("Payment failed. Check console.");
  }
});
</script>
</body>
</html>
